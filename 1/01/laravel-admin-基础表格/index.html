<!DOCTYPE html>
<html lang="zh">
  <head>
    <title>
         - my101du Blog
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="laravel-admin 基础，表格 后台系统大部分都是增删改查，要一个个去创建 controller， views 太麻烦了。如果能够几行命令根据 model 自动生成代码就好了 https://github.com/z-song/laravel-admin 内置用户和" />
    <meta name="generator" content="Hugo 0.70.0 with theme pure" />
    <title> - my101du Blog</title>
    
    
    <link rel="stylesheet" href="http://blog.zhishibee.com/css/style.min.7dc20efbc53647d41aa9ddea0c48e59300223d084e66ea0cbe7c30bd88903acc.css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css" async>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="" />
<meta property="og:description" content="laravel-admin 基础，表格 后台系统大部分都是增删改查，要一个个去创建 controller， views 太麻烦了。如果能够几行命令根据 model 自动生成代码就好了 https://github.com/z-song/laravel-admin 内置用户和" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://blog.zhishibee.com/1/01/laravel-admin-%E5%9F%BA%E7%A1%80%E8%A1%A8%E6%A0%BC/" />

<meta itemprop="name" content="">
<meta itemprop="description" content="laravel-admin 基础，表格 后台系统大部分都是增删改查，要一个个去创建 controller， views 太麻烦了。如果能够几行命令根据 model 自动生成代码就好了 https://github.com/z-song/laravel-admin 内置用户和">

<meta itemprop="wordCount" content="8609">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="laravel-admin 基础，表格 后台系统大部分都是增删改查，要一个个去创建 controller， views 太麻烦了。如果能够几行命令根据 model 自动生成代码就好了 https://github.com/z-song/laravel-admin 内置用户和"/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->
  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://github.com/my101du" target="_blank">
            <img class="img-circle img-rotate" src="https://avatars2.githubusercontent.com/u/1332645?s=460&amp;u=dc114d6baad010456a5af87c4cc2df0694ff2b1c&amp;v=4" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">my101du</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Dongguan, China</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="想要查找什么..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content"><p>enjoy~</p>
            </div>
        </div>
    </div>
</div>

      <div class="widget">
    <h3 class="widget-title"> 分类</h3>
    <div class="widget-body">
        <ul class="category-list">
        </ul>
    </div>
</div>
      <div class="widget">
    <h3 class="widget-title"> 标签</h3>
    <div class="widget-body">
        <ul class="tag-list">
            
        </ul>

    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="http://blog.zhishibee.com/1/01/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="http://blog.zhishibee.com/1/01/bootstrap-%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%E4%B8%8E%E6%8A%80%E5%B7%A7/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="http://blog.zhishibee.com/1/01/bootstrap4/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="http://blog.zhishibee.com/1/01/css-%E5%8A%A8%E7%94%BB/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="http://blog.zhishibee.com/1/01/css-%E5%8A%A8%E7%94%BB%E5%BA%93-animate.css/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">文章目录</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/1/01/laravel-admin-%E5%9F%BA%E7%A1%80%E8%A1%A8%E6%A0%BC/"
    ></a
  >
</h1>

      <div class="article-meta">
        

        <span class="post-comment"><i class="icon icon-comment"></i>&nbsp;<a href="/1/01/laravel-admin-%E5%9F%BA%E7%A1%80%E8%A1%A8%E6%A0%BC/#comments"
            class="article-comment-link">评论</a></span>
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 8609字</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 18分 </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <p>laravel-admin 基础，表格</p>
<p>后台系统大部分都是增删改查，要一个个去创建 controller， views 太麻烦了。如果能够几行命令根据 model 自动生成代码就好了</p>
<p><a href="https://github.com/z-song/laravel-admin">https://github.com/z-song/laravel-admin</a></p>
<ul>
<li>内置用户和权限系统</li>
<li>model-grid支持快速构建数据<strong>表格</strong></li>
<li>model-form支持快速构建数据<strong>表单</strong></li>
<li>model-tree支持快速构建<strong>树状列表</strong>数据</li>
<li>内置40+种<strong>form组件</strong>、以及支持<strong>扩展</strong>组件</li>
<li>支持Laravel的多种<strong>模型关系</strong></li>
<li>mysql、mongodb、pgsql等<strong>多数据库</strong>支持</li>
<li>支持引入<strong>第三方前端库</strong></li>
<li>数据库和artisan<strong>命令行</strong>工具的web实现</li>
<li>支持<strong>自定义图表</strong></li>
<li>多种常用<strong>web组件</strong></li>
<li>支持本地和oss<strong>文件上传</strong></li>
</ul>
<h1 id="引入扩展">引入扩展</h1>
<pre><code class="language-shell">composer require encore/laravel-admin

# 导出配置文件 admin.php、 views 、migrations
php artisan vendor:publish --provider=&quot;Encore\Admin\AdminServiceProvider&quot;
</code></pre>
<h1 id="配置">配置</h1>
<p>现在可以编辑配置文件 <code>config/admin.php</code>，这里面可以修改安装目录、数据库连接等</p>
<p>完整的说明： <a href="https://laravel-admin.org/docs/zh/configuration">https://laravel-admin.org/docs/zh/configuration</a></p>
<p>这里是会创建的表（共 9 张）</p>
<p><img src="/media/15490412690127/15452945058797.jpg" alt="-w533"></p>
<h1 id="正式安装">正式安装</h1>
<p>最后根据刚刚修改后的配置文件, 正式开始安装</p>
<pre><code class="language-shell">php artisan admin:install
</code></pre>
<p><img src="/media/15490412690127/15452946800600.jpg" alt="-w610"></p>
<p>现在可以打开<code>http://localhost/admin/ </code>看到了 （默认账号密码是 admin admin）</p>
<p>后台的安装目录为<code>app/Admin</code>，之后大部分的后台开发编码工作都是在这个目录下进行。</p>
<pre><code class="language-shell">app/Admin
├── Controllers
│   ├── ExampleController.php
│   └── HomeController.php
├── bootstrap.php # laravel-admin的启动文件
└── routes.php   # 配置后台路由


├── app/Admin/
├── config/admin.php
├── resources/lang/
│     └── lang/
│       ├── en/admin.php
│       └── zh-CN/admin.php
├── database/migrations/2016_01_04_173148_create_admin_tables.php
└── public/vendor/laravel-admin/
</code></pre>
<p>静态文件在/public/vendor/laravel-admin目录下</p>
<h1 id="更多扩展实现更多功能">更多扩展实现更多功能</h1>
<p>全部扩展的列表</p>
<p><a href="https://github.com/laravel-admin-extensions">https://github.com/laravel-admin-extensions</a></p>
<p><code>Extension</code> Description
<code>helpers</code> Several tools to help you in development
<code>media-manager</code> Provides a web interface to manage local files
<code>api-tester</code> Help you to test the local laravel APIs
<code>scheduling</code> Scheduling task manager for laravel-admin
<code>redis-manager</code> Redis manager for laravel-admin
<code>backup</code> An admin interface for managing backups
<code>log-viewer</code> Log viewer for laravel
<code>config</code> Config manager for laravel-admin
<code>reporter</code> Provides a developer-friendly web interface to view the exception
<code>wangEditor</code> A rich text editor based on wangeditor
<code>summernote</code> A rich text editor based on summernote
<code>china-distpicker</code> 一个基于distpicker的中国省市区选择器
<code>simplemde</code> A markdow editor based on simplemde
<code>phpinfo</code> Integrate the phpinfo page into laravel-admin
<code>php-editor </code> 	Several programing language editor extensions based on code-mirror
<code>python-editor </code> 
<code>js-editor</code>
<code>css-editor</code>
<code>clike-editor</code>
<code>star-rating</code> Star Rating extension for laravel-admin
<code>json-editor</code> JSON Editor for Laravel-admin
<code>grid-lightbox</code> Turn your grid into a lightbox &amp; gallery
<code>daterangepicker</code> Integrates daterangepicker into laravel-admin
<code>material-ui</code> Material-UI extension for laravel-admin
<code>sparkline</code> Integrates jQuery sparkline into laravel-admin
<code>chartjs</code> Use Chartjs in laravel-admin
<code>simditor</code> Integrates simditor full-rich editor into laravel-admin
<code>cropper</code> A simple jQuery image cropping plugin.
<code>composer-viewer</code> A web interface of composer packages in laravel.</p>
<p>config/admin.php 里可以对这些扩展进行设置</p>
<p><img src="/media/15490412690127/15452945933309.jpg" alt="-w463"></p>
<h1 id="快速开始">快速开始</h1>
<h2 id="1-创建控制器">1. 创建控制器</h2>
<p>以 <code>App\User.php</code>模型为例，生成 CRUD</p>
<p>使用下面的命令，生成对应了 User Model 的后台控制器文件<code>app/Admin/Controllers/UserController.php</code></p>
<p>（注意<code>--model</code> 有两个斜杠进行转义来处理 namespace）</p>
<pre><code class="language-shell">php artisan admin:make UserController --model=App\\User

</code></pre>
<p><strong>问题：如果用了 l5-repository ，会有 RepositoryEloquent 等概念，Model 被挪到了 Entities 目录</strong></p>
<h2 id="2-添加路由">2. 添加路由</h2>
<p>修改文件<code>app/Admin/routes.php</code></p>
<pre><code class="language-shell">$router-&gt;resource('users', UserController::class);
</code></pre>
<h2 id="3-添加左侧菜单栏连接">3. 添加左侧菜单栏连接</h2>
<p>打开后台的菜单中 menu</p>
<p>其中uri填写不包含 admin 路由前缀的的路径部分，比如完整路径是http://localhost:8000/admin/demo/users, 那么就填<code>demo/users</code>，</p>
<p>如果要添加外部链接，只要填写完整的url即可，比如<code>http://laravel-admin.org/</code>.</p>
<h2 id="4-修改-表格表单">4. 修改 表格/表单</h2>
<p>打开 app/Admin/Contollers/UserController.php,找到show()、grid()和form()方法</p>
<p>添加构建代码更多查看<code>model-grid</code>和<code>model-form</code>。</p>
<h2 id="appadminbootstrapphp-可以扩展或者移除组件或者引入前端资源">app/Admin/bootstrap.php 可以扩展或者移除组件，或者引入前端资源</h2>
<h2 id="页面内容与布局">页面内容与布局</h2>
<p>参考后台首页的布局文件<code>HomeController.php</code>的<code>index()</code>方法。</p>
<pre><code class="language-php">return $content
    -&gt;header('Dashboard')
    -&gt;description('Description...')
    -&gt;row(Dashboard::title())
    -&gt;row(function (Row $row) {

        $row-&gt;column(4, function (Column $column) {
            $column-&gt;append(Dashboard::environment());
        });

        $row-&gt;column(4, function (Column $column) {
            $column-&gt;append(Dashboard::extensions());
        });

        $row-&gt;column(4, function (Column $column) {
            $column-&gt;append(Dashboard::dependencies());
        });
    });
</code></pre>
<p><code>Encore\Admin\Layout\Content</code>类用来实现内容区的布局。<code>Content::body($content)</code>方法用来添加页面内容：</p>
<p>其中<code>$content-&gt;body()</code>方法可以接受任何可字符串化的对象作为参数，可以是字符串、数字、包含了<code>__toString</code>方法的对象，实现了<code>Renderable</code>、<code>Htmlable</code>接口的对象，<strong>包括laravel的视图</strong></p>
<p>一个简单的后台页面代码如下：</p>
<pre><code class="language-php">public function index(Content $content)
{
    // 选填
    $content-&gt;header('填写页面头标题');

    // 选填
    $content-&gt;description('填写页面描述小标题');

    // 添加面包屑导航 since v1.5.7
    $content-&gt;breadcrumb(
        ['text' =&gt; '首页', 'url' =&gt; '/admin'],
        ['text' =&gt; '用户管理', 'url' =&gt; '/admin/users'],
        ['text' =&gt; '编辑用户']
    );

    // 填充页面body部分，这里可以填入任何可被渲染的对象
    $content-&gt;body('hello world');

    // 在body中添加另一段内容
    $content-&gt;body('foo bar');

    // `row`是`body`方法的别名
    $content-&gt;row('hello world');

    return $content;
}
</code></pre>
<pre><code class="language-php">// 直接渲染视图输出，Since v1.6.12
$content-&gt;view('dashboard', ['data' =&gt; 'foo']);
</code></pre>
<h3 id="布局bootstrap的栅格系统">布局（bootstrap的栅格系统）</h3>
<p>每行的长度是12</p>
<pre><code class="language-php">//一行
$content-&gt;row('hello')

//多列
$content-&gt;row(function(Row $row) {
    $row-&gt;column(4, 'foo');
    $row-&gt;column(6, 'bar');
    $row-&gt;column(2, 'baz');
});

// 第二列里又有多行
$content-&gt;row(function (Row $row) {

    $row-&gt;column(4, 'xxx');

    $row-&gt;column(8, function (Column $column) {
        $column-&gt;row('111');
        $column-&gt;row('222');
        $column-&gt;row('333');
    });
});

// 第二列的最后一行，又有多个列
$content-&gt;row(function (Row $row) {

    $row-&gt;column(4, 'xxx');

    $row-&gt;column(8, function (Column $column) {
        $column-&gt;row('111');
        $column-&gt;row('222');
        $column-&gt;row(function(Row $row) {
            $row-&gt;column(6, '444');
            $row-&gt;column(6, '555');
        });
    });
});
</code></pre>
<h1 id="表格-基于数据模型">表格 （基于数据模型）</h1>
<h2 id="例子">例子</h2>
<p><code>Encore\Admin\Grid</code>类用于生成基于数据模型的表格</p>
<p>例如 生成 movies 表格</p>
<p>表的 SQL 结构</p>
<pre><code class="language-sql">CREATE TABLE `movies` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `director` int(10) unsigned NOT NULL,
  `describe` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `rate` tinyint unsigned NOT NULL,
  `released` enum(0, 1),
  `release_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `created_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `updated_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
</code></pre>
<p>生成表格 Grid 的代码</p>
<pre><code class="language-php">use App\Models\Movie;
use Encore\Admin\Grid;
use Encore\Admin\Facades\Admin;

$grid = new Grid(new Movie);

// 第一列显示id字段，并将这一列设置为可排序列
$grid-&gt;id('ID')-&gt;sortable();

// 第二列显示title字段，由于title字段名和Grid对象的title方法冲突，所以用Grid的column()方法代替
$grid-&gt;column('title');

// 第三列显示director字段，通过display($callback)方法设置这一列的显示内容为users表中对应的用户名
$grid-&gt;director()-&gt;display(function($userId) {
    return User::find($userId)-&gt;name;
});

// 第四列显示为describe字段
$grid-&gt;describe();

// 第五列显示为rate字段
$grid-&gt;rate();

// 第六列显示released字段，通过display($callback)方法来格式化显示输出
$grid-&gt;released('上映?')-&gt;display(function ($released) {
    return $released ? '是' : '否';
});

// 下面为三个时间字段的列显示
$grid-&gt;release_at();
$grid-&gt;created_at();
$grid-&gt;updated_at();

// filter($callback)方法用来设置表格的简单搜索框
$grid-&gt;filter(function ($filter) {

    // 设置created_at字段的范围查询
    $filter-&gt;between('created_at', 'Created Time')-&gt;datetime();
});
</code></pre>
<h2 id="基本使用方法">基本使用方法</h2>
<h3 id="添加列">添加列</h3>
<pre><code class="language-php">// 直接通过字段名`username`添加列，参数是显示的字符串
$grid-&gt;username('用户名');

// 使用`column`方法，效果和上面一样, 第一个参数是字段名，第二个是显示的字符串
$grid-&gt;column('username', '用户名');

// 添加多列
$grid-&gt;columns('email', 'username' ...);
</code></pre>
<h3 id="修改来源数据其它查询方法可以参考eloquent的查询方法">修改来源数据(其它查询方法可以参考eloquent的查询方法.)</h3>
<pre><code class="language-php">$grid-&gt;model()-&gt;where('id', '&gt;', 100);

$grid-&gt;model()-&gt;orderBy('id', 'desc');

$grid-&gt;model()-&gt;take(100);
</code></pre>
<h3 id="设置每页显示行数">设置每页显示行数</h3>
<pre><code class="language-php">// 默认为每页20条
$grid-&gt;paginate(15);
</code></pre>
<h3 id="修改显示输出的格式">修改显示输出的格式</h3>
<pre><code class="language-php">$grid-&gt;text()-&gt;display(function($text) {
    return str_limit($text, 30, '...');
});

$grid-&gt;name()-&gt;display(function ($name) {
    return &quot;&lt;span class='label'&gt;$name&lt;/span&gt;&quot;;
});

$grid-&gt;email()-&gt;display(function ($email) {
    return &quot;mailto:$email&quot;;
});

// 添加不存在的字段
$grid-&gt;column('column_not_in_table')-&gt;display(function () {
    return 'blablabla....';
});
</code></pre>
<h3 id="调用当前行的其它字段数据组合成并不存在的字段列">调用当前行的其它字段数据，组合成并不存在的字段列</h3>
<p><code>display()</code>方法接收的匿名函数绑定了当前行的数据对象</p>
<pre><code class="language-php">$grid-&gt;first_name();
$grid-&gt;last_name();

// 不存在的字段列，从其他行组合起来
$grid-&gt;column('full_name')-&gt;display(function () {
    return $this-&gt;first_name.' '.$this-&gt;last_name;
});
</code></pre>
<h3 id="禁用某些特性整个grid-如-new-filter-等">禁用某些特性（整个grid, 如 new filter 等）</h3>
<pre><code class="language-php">//禁用创建按钮
$grid-&gt;disableCreateButton();

//禁用分页条
$grid-&gt;disablePagination();

//禁用查询过滤器
$grid-&gt;disableFilter();

//禁用导出数据按钮
$grid-&gt;disableExport();

//禁用行选择checkbox
$grid-&gt;disableRowSelector();

//禁用行操作列
$grid-&gt;disableActions();

//设置分页选择器选项
$grid-&gt;perPages([10, 20, 30, 40, 50]);
</code></pre>
<h2 id="关联模型">关联模型</h2>
<h3 id="一对一">一对一</h3>
<p>users 表和 profiles 表通过 profiles.user_id 字段生成一对一关联</p>
<pre><code class="language-sql">CREATE TABLE `users` (
`id` int(10) unsigned NOT NULL AUTO_INCREMENT,


CREATE TABLE `profiles` (
`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`user_id` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
</code></pre>
<p>对应的数据模型</p>
<pre><code class="language-php">class User extends Model
{
    public function profile()
    {
        return $this-&gt;hasOne(Profile::class);
    }
}

class Profile extends Model
{
    public function user()
    {
        return $this-&gt;belongsTo(User::class);
    }
}
</code></pre>
<p>通过下面的代码可以关联在一个grid里面:</p>
<pre><code class="language-php">$grid-&gt;column('profile.age');
$grid-&gt;column('profile.gender');

//or
$grid-&gt;profile()-&gt;age();
$grid-&gt;profile()-&gt;gender();
</code></pre>
<h3 id="一对多">一对多</h3>
<p>posts表和comments表通过comments.post_id字段生成一对多关联</p>
<pre><code class="language-sql">CREATE TABLE `posts` (
`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`title` varchar(255) COLLATE utf8_unicode_ci NOT NULL,

CREATE TABLE `comments` (
`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`post_id` int(10) unsigned NOT NULL,
</code></pre>
<pre><code class="language-php">class Post extends Model
{
    public function comments()
    {
        return $this-&gt;hasMany(Comment::class);
    }
}

class Comment extends Model
{
    public function post()
    {
        return $this-&gt;belongsTo(Post::class);
    }
}
</code></pre>
<p>Grid 代码</p>
<pre><code class="language-php">// 在 Post Grid
$grid-&gt;comments('评论数')-&gt;display(function ($comments) {
        $count = count($comments);
        return &quot;&lt;span class='label label-warning'&gt;{$count}&lt;/span&gt;&quot;;
    });


// 在 Commet Grid
 $grid = new Grid(new Comment);
$grid-&gt;id('id');
$grid-&gt;post()-&gt;title();
$grid-&gt;post()-&gt;title('Post Title'); // 如果希望修改表头上显示的名称
</code></pre>
<h3 id="多对多">多对多</h3>
<p>users和roles表通过中间表role_users产生多对多关系</p>
<pre><code class="language-sql">CREATE TABLE `users` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
   PRIMARY KEY (`id`),
  UNIQUE KEY `users_username_unique` (`username`)

CREATE TABLE `roles` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `slug` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `roles_name_unique` (`name`)

CREATE TABLE `role_users` (
  `role_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  KEY `role_users_role_id_user_id_index` (`role_id`,`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci
</code></pre>
<p>数据建模</p>
<pre><code class="language-php">class User extends Model
{
    public function roles()
    {
        return $this-&gt;belongsToMany(Role::class);
    }
}

class Role extends Model
{
    public function users()
    {
        return $this-&gt;belongsToMany(User::class);
    }
}
</code></pre>
<p>Grid 中的关联</p>
<pre><code class="language-php">$grid = new Grid(new User);

$grid-&gt;roles()-&gt;display(function ($roles) {

    $roles = array_map(function ($role) {
        return &quot;&lt;span class='label label-success'&gt;{$role['name']}&lt;/span&gt;&quot;;
    }, $roles);

    return join('&amp;nbsp;', $roles);
});

</code></pre>
<h2 id="模型表格行操作和扩展">模型表格&quot;行&quot;操作和扩展</h2>
<h3 id="关闭行操作-查看详情编辑删除">关闭行操作 （查看详情，编辑，删除）</h3>
<p>model-grid默认有两个行操作<code>编辑</code>和<code>删除</code>，可以通过下面的方式关闭它们：</p>
<pre><code class="language-php">$grid-&gt;actions(function ($actions) {
    $actions-&gt;disableDelete();
    $actions-&gt;disableEdit();
    $actions-&gt;disableView();
});
</code></pre>
<h3 id="获取当前行的数据">获取当前行的数据</h3>
<p>可以通过传入的<code>$actions</code>参数来获取当前行的数据</p>
<pre><code class="language-php">$grid-&gt;actions(function ($actions) {

    // 当前行的数据数组
    $actions-&gt;row;

    // 获取当前行主键值
    $actions-&gt;getKey();
});
</code></pre>
<h3 id="添加自定义的操作按钮">添加自定义的操作按钮</h3>
<pre><code class="language-php">$grid-&gt;actions(function ($actions) {

    // append一个操作
    $actions-&gt;append('&lt;a href=&quot;&quot;&gt;&lt;i class=&quot;fa fa-eye&quot;&gt;&lt;/i&gt;&lt;/a&gt;');

    // prepend一个操作
    $actions-&gt;prepend('&lt;a href=&quot;&quot;&gt;&lt;i class=&quot;fa fa-paper-plane&quot;&gt;&lt;/i&gt;&lt;/a&gt;');
});
</code></pre>
<h3 id="比较复杂的操作先定义操作类">比较复杂的操作,先定义操作类</h3>
<pre><code class="language-php">namespace App\Admin\Extensions;

use Encore\Admin\Admin;

class CheckRow
{
    protected $id;

    public function __construct($id)
    {
        $this-&gt;id = $id;
    }

    protected function script()
    {
        return &lt;&lt;&lt;SCRIPT

$('.grid-check-row').on('click', function () {

    // Your code.
    console.log($(this).data('id'));

});

SCRIPT;
    }

    protected function render()
    {
        Admin::script($this-&gt;script());

        return &quot;&lt;a class='btn btn-xs btn-success fa fa-check grid-check-row' data-id='{$this-&gt;id}'&gt;&lt;/a&gt;&quot;;
    }

    public function __toString()
    {
        return $this-&gt;render();
    }
}
</code></pre>
<p>然后添加操作</p>
<pre><code class="language-php">$grid-&gt;actions(function ($actions) {

    // 添加操作
    $actions-&gt;append(new CheckRow($actions-&gt;getKey()));
});
</code></pre>
<h2 id="模型表格列操作和扩展">模型表格&quot;列&quot;操作和扩展</h2>
<h3 id="修改列显示例如背景色">修改列显示（例如背景色）</h3>
<p><code>display()</code>方法来通过传入的回调函数来处理当前列的值(<code>value()</code>方法作为<code>display()</code>方法的别名存在)</p>
<pre><code class="language-php">$grid-&gt;column('title')-&gt;display(function ($title) {

    return &quot;&lt;span style='color:blue'&gt;$title&lt;/span&gt;&quot;;

});
</code></pre>
<p>在传入的匿名函数中可以通过任何方式对数据进行处理，另外匿名函数绑定了当前列的数据作为父对象，可以在函数中<strong>调用当前行的数据</strong>：(例如这个例子里，本行的 <code>$this-&gt;first_name</code> 和 <code>$this-&gt;last_name</code>)</p>
<pre><code class="language-php">// 不存在的`full_name`字段
$grid-&gt;column('full_name')-&gt;display(function () {
    return $this-&gt;first_name . ' ' . $this-&gt;last_name;
});
</code></pre>
<h3 id="列对象的setattributes-给当前这一列的每一行添加html属性">列对象的<code>setAttributes()</code> ：给当前这一列的每一行添加HTML属性</h3>
<p>列头部就会出现一个排序icon, 点击进行排序</p>
<pre><code class="language-php">$grid-&gt;column('title')-&gt;setAttributes(['style' =&gt; 'color:red;']);

//setAttributes()方法封装了style()方法，直接添加样式
$grid-&gt;column('desc')-&gt;style('max-width:200px;word-break:break-all;');
</code></pre>
<h3 id="使用sortable方法把当前列设置为可排序列">使用sortable()方法把当前列设置为可排序列</h3>
<pre><code class="language-php">$grid-&gt;column('created_at')-&gt;sortable();
</code></pre>
<h3 id="view方法让当前列-渲染一个视图-显示输出">view()方法让当前列 渲染一个视图 显示输出</h3>
<p>比如有一个视图resources/views/content.blade.php</p>
<pre><code class="language-html">&lt;p&gt;
    {{ $value }}
    {{ $model-&gt;id }}
&lt;/p&gt;
</code></pre>
<p>使用下面的方法， 默认会传入视图的两个变量，<code>$model</code>为当前行的模型，<code>$value</code>为当前列的值。 用这个方法可以很好的渲染出<strong>复杂的列内容</strong>。</p>
<pre><code class="language-php">$grid-&gt;column('content')-&gt;view('content');
</code></pre>
<h3 id="其它方法-switch-select-image-直接在表格中编辑数据-等等">其它方法 (switch select image, 直接在表格中编辑数据 等等)</h3>
<p><strong>using</strong> 实际的 值 用别的代号来显示</p>
<p>如果字段gender的取值为f、m，分别需要用女、男来显示</p>
<pre><code class="language-php">$grid-&gt;gender()-&gt;using(['f' =&gt; '女', 'm' =&gt; '男']);
</code></pre>
<p><strong>editable</strong> 通过editable.js的帮助，可以让你在表格中直接编辑数据</p>
<pre><code class="language-php">$grid-&gt;title()-&gt;editable();

$grid-&gt;title()-&gt;editable('textarea');

$grid-&gt;title()-&gt;editable('select', [1 =&gt; 'option1', 2 =&gt; 'option2', 3 =&gt; 'option3']);

$grid-&gt;birth()-&gt;editable('date');

$grid-&gt;published_at()-&gt;editable('datetime');

$grid-&gt;column('year')-&gt;editable('year');

$grid-&gt;column('month')-&gt;editable('month');

$grid-&gt;column('day')-&gt;editable('day');
</code></pre>
<p><strong>switch</strong> 快速将列变成开关组件（例如 status=1|0）</p>
<p>注意：在grid中对某字段设置了switch，同时需要在form里面对该字段设置同样的switch</p>
<pre><code class="language-php">$grid-&gt;status()-&gt;switch();

// 设置text、color、和存储值
$states = [
    'on'  =&gt; ['value' =&gt; 1, 'text' =&gt; '打开', 'color' =&gt; 'primary'],
    'off' =&gt; ['value' =&gt; 2, 'text' =&gt; '关闭', 'color' =&gt; 'default'],
];
$grid-&gt;status()-&gt;switch($states);
</code></pre>
<p><strong>switchGroup</strong> 快速将列变成开关组件组</p>
<p>注意：在grid中对某些字段设置了switch，同时需要在form里面对这些字段设置同样的switch</p>
<pre><code class="language-php">$states = [
    'on' =&gt; ['text' =&gt; 'YES'],
    'off' =&gt; ['text' =&gt; 'NO'],
];

$grid-&gt;column('switch_group')-&gt;switchGroup([
    'hot'       =&gt; '热门',
    'new'       =&gt; '最新'
    'recommend' =&gt; '推荐',
], $states);
</code></pre>
<p><strong>select</strong></p>
<pre><code class="language-php">$grid-&gt;options()-&gt;select([
    1 =&gt; 'Sed ut perspiciatis unde omni',
    2 =&gt; 'voluptatem accusantium doloremque',
    3 =&gt; 'dicta sunt explicabo',
    4 =&gt; 'laudantium, totam rem aperiam',
]);
</code></pre>
<p><strong>radio</strong></p>
<pre><code class="language-php">$grid-&gt;options()-&gt;radio([
    1 =&gt; 'Sed ut perspiciatis unde omni',
    2 =&gt; 'voluptatem accusantium doloremque',
    3 =&gt; 'dicta sunt explicabo',
    4 =&gt; 'laudantium, totam rem aperiam',
]);
</code></pre>
<p><strong>checkbox</strong></p>
<pre><code class="language-php">$grid-&gt;options()-&gt;checkbox([
    1 =&gt; 'Sed ut perspiciatis unde omni',
    2 =&gt; 'voluptatem accusantium doloremque',
    3 =&gt; 'dicta sunt explicabo',
    4 =&gt; 'laudantium, totam rem aperiam',
]);
</code></pre>
<p><strong>image</strong></p>
<pre><code class="language-php">$grid-&gt;picture()-&gt;image();

//设置服务器和宽高
$grid-&gt;picture()-&gt;image('http://xxx.com', 100, 100);

// 显示多图
$grid-&gt;pictures()-&gt;display(function ($pictures) {

    return json_decode($pictures, true);

})-&gt;image('http://xxx.com', 100, 100);
</code></pre>
<p><strong>label</strong></p>
<pre><code class="language-php">$grid-&gt;name()-&gt;label();

//设置颜色，默认`success`,可选`danger`、`warning`、`info`、`primary`、`default`、`success`
$grid-&gt;name()-&gt;label('danger');

// 接收数组
$grid-&gt;keywords()-&gt;label();
</code></pre>
<p><strong>badge</strong></p>
<pre><code class="language-php">$grid-&gt;name()-&gt;badge();

//设置颜色，默认`success`,可选`danger`、`warning`、`info`、`primary`、`default`、`success`
$grid-&gt;name()-&gt;badge('danger');

// 接收数组
$grid-&gt;keywords()-&gt;badge();
</code></pre>
<h3 id="扩展列功能例如统一给某一列添加-click-动作等">扩展列功能（例如统一给某一列添加 click 动作等）</h3>
<p><strong>如果比较简单，通过 匿名函数 的方式</strong></p>
<p>在<code>app/Admin/bootstrap.php</code>加入以下代码:</p>
<pre><code class="language-php">use Encore\Admin\Grid\Column;

Column::extend('color', function ($value, $color) {
    return &quot;&lt;span style='color: $color'&gt;$value&lt;/span&gt;&quot;;
});
</code></pre>
<p>然后在model-grid中使用这个扩展：</p>
<pre><code class="language-php">$grid-&gt;title()-&gt;color('#ccc');
</code></pre>
<p><strong>如果列显示逻辑比较复杂，可以通过 扩展类 来实现。</strong></p>
<p>扩展类<code>app/Admin/Extensions/Popover.php</code>:</p>
<pre><code class="language-php">namespace App\Admin\Extensions;

use Encore\Admin\Admin;
use Encore\Admin\Grid\Displayers\AbstractDisplayer;

class Popover extends AbstractDisplayer
{
    public function display($placement = 'left')
    {
        Admin::script(&quot;$('[data-toggle=\&quot;popover\&quot;]').popover()&quot;);

        return &lt;&lt;&lt;EOT
&lt;button type=&quot;button&quot;
    class=&quot;btn btn-secondary&quot;
    title=&quot;popover&quot;
    data-container=&quot;body&quot;
    data-toggle=&quot;popover&quot;
    data-placement=&quot;$placement&quot;
    data-content=&quot;{$this-&gt;value}&quot;
    &gt;
  弹出提示
&lt;/button&gt;

EOT;

    }
}
</code></pre>
<p>在<code>app/Admin/bootstrap.php</code>注册扩展类</p>
<pre><code class="language-php">use Encore\Admin\Grid\Column;
use App\Admin\Extensions\Popover;

Column::extend('popover', Popover::class);
</code></pre>
<p>然后就能在model-grid中使用了：</p>
<pre><code class="language-php">$grid-&gt;desciption()-&gt;popover('right');
</code></pre>
<h3 id="辅助方法-处理数据的显示格式等">辅助方法 处理数据的显示格式等</h3>
<p><strong>字符串操作</strong></p>
<p>通过链式方法调用Illuminate\Support\Str的方法</p>
<pre><code class="language-php">$grid-&gt;title()-&gt;limit(30);

$grid-&gt;title()-&gt;limit(30)-&gt;ucfirst();

$grid-&gt;title()-&gt;limit(30)-&gt;ucfirst()-&gt;substr(1, 10);
</code></pre>
<p><strong>数组操作</strong></p>
<p>可以直接链式调用<code>Illuminate\Support\Collection</code>方法</p>
<p>比如<code>tags</code>列是从一对多关系取出来的数组数据</p>
<pre><code class="language-php">$grid-&gt;tags();

array (
  0 =&gt; 
  array (
    'id' =&gt; '16',
    'name' =&gt; 'php',
    'created_at' =&gt; '2016-11-13 14:03:03',
    'updated_at' =&gt; '2016-12-25 04:29:35',

  ),
  1 =&gt; 
  array (
    'id' =&gt; '17',
    'name' =&gt; 'python',
    'created_at' =&gt; '2016-11-13 14:03:09',
    'updated_at' =&gt; '2016-12-25 04:30:27',
  ),
)
</code></pre>
<p><strong>链式调用</strong></p>
<pre><code class="language-php">// pluck()
$grid-&gt;tags()-&gt;pluck('name');

array (
    0 =&gt; 'php',
    1 =&gt; 'python',
  ),
  
// map()
$grid-&gt;tags()-&gt;pluck('name')-&gt;map('ucwords');

array (
    0 =&gt; 'Php',
    1 =&gt; 'Python',
  ),

// 数组输出为字符串
$grid-&gt;tags()-&gt;pluck('name')-&gt;map('ucwords')-&gt;implode('-');

&quot;Php-Python&quot;
</code></pre>
<p><strong>混合使用</strong></p>
<p>在上面两种类型的方法调用中，只要上一步输出的是确定类型的值，便可以调用类型对应的方法，所以可以很灵活的混合使用。比如<code>images</code>字段是存储多图片地址数组的JSON格式字符串类型</p>
<pre><code class="language-php">$grid-&gt;images();

&quot;['foo.jpg', 'bar.png']&quot;

// 链式方法调用来显示多图
$grid-&gt;images()-&gt;display(function ($images) {

    return json_decode($images, true);

})-&gt;map(function ($path) {

    return 'http://localhost/images/'. $path;

})-&gt;image();
</code></pre>
<h2 id="扩展顶部的自定义工具-grid-头部-tools">扩展顶部的自定义工具 (grid 头部 tools)</h2>
<p>在model-grid的头部默认有<code>批量删除</code>和<code>刷新</code>两个操作工具</p>
<p>下面的示例添加一个 性别分类选择 的按钮组工具</p>
<p>先定义工具类<code>app/Admin/Extensions/Tools/UserGender.php</code>：</p>
<pre><code class="language-php">namespace App\Admin\Extensions\Tools;

use Encore\Admin\Admin;
use Encore\Admin\Grid\Tools\AbstractTool;
use Illuminate\Support\Facades\Request;

class UserGender extends AbstractTool
{
    protected function script()
    {
        $url = Request::fullUrlWithQuery(['gender' =&gt; '_gender_']);

        return &lt;&lt;&lt;EOT

$('input:radio.user-gender').change(function () {

    var url = &quot;$url&quot;.replace('_gender_', $(this).val());

    $.pjax({container:'#pjax-container', url: url });

});

EOT;
    }

    public function render()
    {
        Admin::script($this-&gt;script());

        $options = [
            'all'   =&gt; 'All',
            'm'     =&gt; 'Male',
            'f'     =&gt; 'Female',
        ];

        return view('admin.tools.gender', compact('options'));
    }
}
</code></pre>
<p>视图admin.tools.gender文件为resources/views/admin/tools/gender.blade.php:</p>
<pre><code class="language-php">&lt;div class=&quot;btn-group&quot; data-toggle=&quot;buttons&quot;&gt;
    @foreach($options as $option =&gt; $label)
    &lt;label class=&quot;btn btn-default btn-sm {{ \Request::get('gender', 'all') == $option ? 'active' : '' }}&quot;&gt;
        &lt;input type=&quot;radio&quot; class=&quot;user-gender&quot; value=&quot;{{ $option }}&quot;&gt;{{$label}}
    &lt;/label&gt;
    @endforeach
&lt;/div&gt;
</code></pre>
<p>在model-grid引入这个工具</p>
<pre><code class="language-php">$grid-&gt;tools(function ($tools) {
    $tools-&gt;append(new UserGender());
});
</code></pre>
<p>在model-grid定义中接收到gender参数后，做好数据查询就可以了</p>
<pre><code class="language-php">if (in_array(Request::get('gender'), ['m', 'f'])) {
    $grid-&gt;model()-&gt;where('gender', Request::get('gender'));
}
</code></pre>
<h3 id="批量操作-与-添加自定义的批量操作">批量操作 与 添加自定义的批量操作</h3>
<p>目前默认实现了批量删除操作的功能，如果要关掉批量删除操作：</p>
<pre><code class="language-php">$grid-&gt;tools(function ($tools) {
    $tools-&gt;batch(function ($batch) {
        $batch-&gt;disableDelete();
    });
});
</code></pre>
<p>如果要添加自定义的批量操作，下面是扩展一个对文章批量发布的功能</p>
<p>先定义操作类<code>app/Admin/Extensions/Tools/ReleasePost.php</code>：</p>
<pre><code class="language-php">namespace App\Admin\Extensions\Tools;

use Encore\Admin\Grid\Tools\BatchAction;

class ReleasePost extends BatchAction
{
    protected $action;

    public function __construct($action = 1)
    {
        $this-&gt;action = $action;
    }

    public function script()
    {
        return &lt;&lt;&lt;EOT

$('{$this-&gt;getElementClass()}').on('click', function() {

    $.ajax({
        method: 'post',
        url: '{$this-&gt;resource}/release',
        data: {
            _token:LA.token,
            ids: selectedRows(),
            action: {$this-&gt;action}
        },
        success: function () {
            $.pjax.reload('#pjax-container');
            toastr.success('操作成功');
        }
    });
});

EOT;

    }
}
</code></pre>
<p>通过click操作发送一个post请求，把选中的行数据id通过数组的形式传给后端接口，后端接口拿到id列表和要修改的状态来更新数据，然后前端刷新页面(pjax reload)，并弹出toastr提示操作成功。</p>
<p>在model-grid中加入这个批量操作功能</p>
<pre><code class="language-php">$grid-&gt;tools(function ($tools) {
    $tools-&gt;batch(function ($batch) {
        $batch-&gt;add('发布文章', new ReleasePost(1));
        $batch-&gt;add('文章下线', new ReleasePost(0));
    });
});
</code></pre>
<p>最后一步就是在后端添加一个接口来处理批量操作的请求了，接口代码如下：</p>
<pre><code class="language-php">class PostController extends Controller
{
    ...

    public function release(Request $request)
    {
        foreach (Post::find($request-&gt;get('ids')) as $post) {
            $post-&gt;released = $request-&gt;get('action');
            $post-&gt;save();
        }
    }

    ...
}
</code></pre>
<p>最后 添加路由指向上面的接口</p>
<pre><code class="language-php">$router-&gt;post('posts/release', 'PostController@release');
</code></pre>
<h2 id="修改表格数据源">修改表格数据源</h2>
<h3 id="数据来自模型">数据来自模型</h3>
<p>查询方法可以参考eloquent的查询方法</p>
<pre><code class="language-php">// 添加默认查询条件
$grid-&gt;model()-&gt;where('id', '&gt;', 100);

// 设置初始排序条件
$grid-&gt;model()-&gt;orderBy('id', 'desc');
</code></pre>
<h3 id="数据来自外部api">数据来自外部API</h3>
<p>可以建立 model ,然后覆盖掉模型的几个获取数据的方法来实现, 下面的例子用豆瓣电影的API获取并展示数据：</p>
<p>通过覆盖模型的<code>paginate</code>和<code>with</code>方法获取API数据，通过<code>findOrFail</code>方法来获取单项数据展示在表单中</p>
<pre><code class="language-php">namespace App\Models\Movie;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Pagination\LengthAwarePaginator;
use Illuminate\Support\Facades\Request;

class InTheater extends Model
{
    public function paginate()
    {
        $perPage = Request::get('per_page', 10);

        $page = Request::get('page', 1);

        $start = ($page-1)*$perPage;

        $data = file_get_contents(&quot;https://api.douban.com/v2/movie/in_theaters?city=上海&amp;start=$start&amp;count=$perPage&quot;);

        $data = json_decode($data, true);

        extract($data);

        $movies = static::hydrate($subjects);

        $paginator = new LengthAwarePaginator($movies, $total, $perPage);

        $paginator-&gt;setPath(url()-&gt;current());

        return $paginator;
    }

    public static function with($relations)
    {
        return new static;
    }
}
</code></pre>
<p>同理如果要在 form 表单中获取或者保存数据那么也可以通过覆盖相应的方法来实现：</p>
<pre><code class="language-php">// 获取单项数据展示在form中
public function findOrFail($id)
{
    $data = file_get_contents(&quot;http://api.douban.com/v2/movie/subject/$id&quot;);

    $data = json_decode($data, true);

    return static::newFromBuilder($data);
}

// 保存提交的form数据
public function save(array $options = [])
{
    $attributes = $this-&gt;getAttributes();

    // save $attributes
}
</code></pre>
<h3 id="一个数据来自其他来源的例子">一个数据来自其他来源的例子</h3>
<p><a href="https://www.cc430.cn/index.php/archives/695/">https://www.cc430.cn/index.php/archives/695/</a></p>
<p>（这个作者有不少文章质量高。也是和 laravel-admin 有关的）</p>
<p>没有存一个表，数据来源于两个部分，一个是用户已付款订单（入），另外一个是商家的提现订单（出）</p>
<pre><code class="language-php">public function __construct()
{
    $this-&gt;class = new Finance();
}

protected function grid()
{
    return Admin::grid($this-&gt;class, function (Grid $grid) {
        if (Admin::user()-&gt;isRole('shop') &amp;&amp; Admin::user()-&gt;shop_id) {
            $grid-&gt;model()-&gt;where('shop_id', Admin::user()-&gt;shop_id);
        }
        $grid-&gt;shop_id('打印店')-&gt;display(function ($shop_id) {
            $shop = Shop::find($shop_id);
            return $shop-&gt;name;
        });
</code></pre>
<p>模型</p>
<h3 id="数据来自复杂sql查询">数据来自复杂SQL查询</h3>
<p>第一个办法就是上面的方法，覆盖掉model的方法实现
第二个方式是在数据库中建立视图和model绑定(未测试过，理论上可行&hellip;?? ?)</p>
<pre><code class="language-php">public function paginate()
{
    $perPage = Request::get('per_page', 10);

    $page = Request::get('page', 1);

    $start = ($page-1)*$perPage;

    // 运行sql获取数据数组
    $sql = 'select * from ...';

    $result = DB::select($sql);

    $movies = static::hydrate($result);

    $paginator = new LengthAwarePaginator($movies, $total, $perPage);

    $paginator-&gt;setPath(url()-&gt;current());

    return $paginator;
}

public static function with($relations)
{
    return new static;
}
</code></pre>
<h2 id="数据查询过滤在表格顶部区域进行数据查询">数据查询过滤（在表格顶部区域进行数据查询）</h2>
<pre><code class="language-php">$grid-&gt;filter(function($filter){

    // 去掉默认的id过滤器
    $filter-&gt;disableIdFilter();

    // 在这里添加字段过滤器
    $filter-&gt;like('name', 'name');
    ...

});
</code></pre>
<p>过滤查询面板从原来的弹出modal改为嵌入表格头部，通过点击筛选按钮展开显示，默认是不展开的，用下面的方式可以让它默认展开</p>
<pre><code class="language-php">// 在`$grid`实例上操作
$grid-&gt;expandFilter();

// 或者在filter回调里面操作`$filter`实例
$filter-&gt;expand();
</code></pre>
<h3 id="定义查询范围">定义查询范围</h3>
<p>使用<code>$filter-&gt;scope()</code>可以把你最常用的查询定义为一个查询范围，它将会出现在筛选按钮的下拉菜单中</p>
<p><code>scope</code>方法第一个参数为查询的 key, 会出现的url参数中，第二个参数是下拉菜单项的label, 如果不填，第一个参数会作为label显示</p>
<pre><code class="language-php">$filter-&gt;scope('male', '男性')-&gt;where('gender', 'm');

// 多条件查询
$filter-&gt;scope('new', '最近修改')
    -&gt;whereDate('created_at', date('Y-m-d'))
    -&gt;orWhere('updated_at', date('Y-m-d'));

// 关联关系查询
$filter-&gt;scope('address')-&gt;whereHas('profile', function ($query) {
    $query-&gt;whereNotNull('address');
});

$filter-&gt;scope('trashed', '被软删除的数据')-&gt;onlyTrashed();
</code></pre>
<p><code>scope</code>方法可以链式调用任何eloquent查询条件</p>
<h3 id="查询类型">查询类型</h3>
<p>下面这些都支持 (使用表单字段值作为<code>$input</code>传入SQL中)</p>
<pre><code class="language-php">$filter-&gt;equal('column', $label);

$filter-&gt;notEqual('column', $label);

$filter-&gt;like('column', $label);
$filter-&gt;ilike('column', $label);

$filter-&gt;gt('column', $label);
$filter-&gt;lt('column', $label);

$filter-&gt;between('column', $label);

// 设置datetime类型
$filter-&gt;between('column', $label)-&gt;datetime();

// 设置time类型
$filter-&gt;between('column', $label)-&gt;time();

$filter-&gt;in('column', $label)-&gt;multipleSelect(['key' =&gt; 'value']);

$filter-&gt;notIn('column', $label)-&gt;multipleSelect(['key' =&gt; 'value']);

$filter-&gt;date('column', $label);
$filter-&gt;day('column', $label);
$filter-&gt;month('column', $label);
$filter-&gt;year('column', $label);


//可以用`where`来构建比较复杂的查询过滤  (注意这里的 $this-&gt;input 是传入的数据)
$filter-&gt;where(function ($query) {

    $query-&gt;where('title', 'like', &quot;%{$this-&gt;input}%&quot;)
        -&gt;orWhere('content', 'like', &quot;%{$this-&gt;input}%&quot;);

}, 'Text');


// 以及 whereRaw 原生 SQL 语句
$filter-&gt;where(function ($query) {

    $query-&gt;whereRaw(&quot;`rate` &gt;= 6 AND `created_at` = {$this-&gt;input}&quot;);

}, 'Text');

//关系查询，查询对应关系profile的字段：
$filter-&gt;where(function ($query) {

    $query-&gt;whereHas('profile', function ($query) {
        $query-&gt;where('address', 'like', &quot;%{$this-&gt;input}%&quot;)-&gt;orWhere('email', 'like', &quot;%{$this-&gt;input}%&quot;);
    });

}, '地址或手机号');
</code></pre>
<h3 id="表单类型">表单类型</h3>
<h4 id="默认是-text-input">默认是 text input</h4>
<pre><code class="language-php">//默认
$filter-&gt;equal('column')-&gt;placeholder('请输入。。。');

//限制
$filter-&gt;equal('column')-&gt;url();

$filter-&gt;equal('column')-&gt;email();

$filter-&gt;equal('column')-&gt;integer();

$filter-&gt;equal('column')-&gt;ip();

$filter-&gt;equal('column')-&gt;mac();

$filter-&gt;equal('column')-&gt;mobile();

// $options 参考 https://github.com/RobinHerbots/Inputmask/blob/4.x/README_numeric.md
$filter-&gt;equal('column')-&gt;decimal($options = []);

// $options 参考 https://github.com/RobinHerbots/Inputmask/blob/4.x/README_numeric.md
$filter-&gt;equal('column')-&gt;currency($options = []);

// $options 参考 https://github.com/RobinHerbots/Inputmask/blob/4.x/README_numeric.md
$filter-&gt;equal('column')-&gt;percentage($options = []);

// $options 参考 https://github.com/RobinHerbots/Inputmask, $icon为input前面的图标
$filter-&gt;equal('column')-&gt;inputmask($options = [], $icon = 'pencil');
</code></pre>
<h4 id="select-与-multipleselect">select 与 multipleSelect</h4>
<pre><code class="language-php">$filter-&gt;equal('column')-&gt;select(['key' =&gt; 'value'...]);

// 或者从api获取数据，api的格式参考model-form的select组件
$filter-&gt;equal('column')-&gt;select('api/users');


// 一般用来配合in和notIn两个需要查询数组的查询类型使用，也可以在where类型的查询中使用
$filter-&gt;in('column')-&gt;multipleSelect(['key' =&gt; 'value'...]);

// 或者从api获取数据，api的格式参考model-form的multipleSelect组件
$filter-&gt;in('column')-&gt;multipleSelect('api/users');
</code></pre>
<p><strong>搜索问题： 级联</strong></p>
<p>例如一个select（市）和前面一个 select(省)是关联的</p>
<p>可以用和 表单模型 里类似的 <code>load()</code>来实现</p>
<pre><code class="language-php">$filter-&gt;equal('country_or_state')-&gt;select([]);

$filter-&gt;equal('area')-&gt;select($allArea)-&gt;load('country_or_state', '/api/countries/area/' . $area); 
</code></pre>
<p><img src="/media/15490412690127/15454047110947.jpg" alt="-w587"></p>
<h4 id="radio-与-checkbox">radio 与 checkbox</h4>
<pre><code class="language-php">$filter-&gt;equal('released')-&gt;radio([
    ''   =&gt; 'All',
    0    =&gt; 'Unreleased',
    1    =&gt; 'Released',
]);

//checkbox 比较常见的场景是配合whereIn来做范围筛选
$filter-&gt;in('gender')-&gt;checkbox([
    'm'    =&gt; 'Male',
    'f'    =&gt; 'Female',
]);
</code></pre>
<h4 id="datetime">datetime</h4>
<p>通过日期时间组件来查询，$options的参数和值参考bootstrap-datetimepicker</p>
<pre><code class="language-php">$filter-&gt;equal('column')-&gt;datetime($options);

// `date()` 相当于 `datetime(['format' =&gt; 'YYYY-MM-DD'])`
$filter-&gt;equal('column')-&gt;date();

// `time()` 相当于 `datetime(['format' =&gt; 'HH:mm:ss'])`
$filter-&gt;equal('column')-&gt;time();

// `day()` 相当于 `datetime(['format' =&gt; 'DD'])`
$filter-&gt;equal('column')-&gt;day();

// `month()` 相当于 `datetime(['format' =&gt; 'MM'])`
$filter-&gt;equal('column')-&gt;month();

// `year()` 相当于 `datetime(['format' =&gt; 'YYYY'])`
$filter-&gt;equal('column')-&gt;year();
</code></pre>
<h3 id="复杂查询过滤器">复杂查询过滤器</h3>
<p>使用<code>$this-&gt;input()</code>来触发复杂的自定义查询，比如说，根据传入的 input 值进行条件判断，再在内部对query 进行处理</p>
<pre><code class="language-php">$filter-&gt;where(function ($query) {
    switch ($this-&gt;input) {
        case 'yes':
            // custom complex query if the 'yes' option is selected
            $query-&gt;has('somerelationship');
            break;
        case 'no':
            $query-&gt;doesntHave('somerelationship');
            break;
    }
}, 'Label of the field', 'name_for_url_shortcut')-&gt;radio([
    '' =&gt; 'All',
    'yes' =&gt; 'Only with relationship',
    'no' =&gt; 'Only without relationship',
]);
</code></pre>
<h3 id="过滤器多列布局">过滤器多列布局</h3>
<p>如果过滤器太多，会把页面拉的很长，将会很影响页面的观感，这个版本将支持过滤器的多列布局, 比如6个过滤器分两列显示</p>
<pre><code class="language-php">$filter-&gt;column(1/2, function ($filter) {
    $filter-&gt;like('title');
    $filter-&gt;between('rate');
});

$filter-&gt;column(1/2, function ($filter) {
    $filter-&gt;equal('created_at')-&gt;datetime();
    $filter-&gt;between('updated_at')-&gt;datetime();
    $filter-&gt;equal('released')-&gt;radio([
        1 =&gt; 'YES',
        0 =&gt; 'NO',
    ]);
});
</code></pre>
<blockquote>
<p>默认会有一个主键字段的过滤器放在第一列，所有左右各三个过滤器一共6个过滤器</p>
</blockquote>
<h3 id="过滤器组">过滤器组</h3>
<p>对同一个字段要设置多中筛选方式</p>
<p><img src="/media/15490412690127/15453200155969.png" alt=""></p>
<pre><code class="language-php">$filter-&gt;group('rate', function ($group) {
    $group-&gt;gt('大于');
    $group-&gt;lt('小于');
    $group-&gt;nlt('不小于');
    $group-&gt;ngt('不大于');
    $group-&gt;equal('等于');
});

</code></pre>
<p>可以有几个方法调用：</p>
<pre><code class="language-php">// 等于
$group-&gt;equal();

// 不等于
$group-&gt;notEqual();

// 大于
$group-&gt;gt();

// 小于
$group-&gt;lt();

// 大于等于
$group-&gt;nlt();

// 小于等于
$group-&gt;ngt();

// 匹配
$group-&gt;match();

// 复杂条件
$group-&gt;where();

// like查询
$group-&gt;like();

// like查询
$group-&gt;contains();

// ilike查询
$group-&gt;ilike();

// 以输入的内容开头
$group-&gt;startWith();

// 以输入的内容结尾
$group-&gt;endWith();
</code></pre>
<h2 id="数据导出">数据导出</h2>
<p>只是实现了简单的csv格式文件的导出。</p>
<p>如果遇到文件编码问题或者满足不了自己需求的情况，可以按照下面的步骤来自定义导出功能</p>
<p>（示例用Laravel-Excel作为excel操作库, 详细资料：http://www.maatwebsite.nl/laravel-excel/docs）</p>
<pre><code class="language-shell">composer require maatwebsite/excel:~2.1.0

php artisan vendor:publish --provider=&quot;Maatwebsite\Excel\ExcelServiceProvider&quot;
</code></pre>
<p>新建自定义导出类，比如<code>app/Admin/Extensions/ExcelExpoter.php</code>:</p>
<pre><code class="language-php">namespace App\Admin\Extensions;

use Encore\Admin\Grid\Exporters\AbstractExporter;
use Maatwebsite\Excel\Facades\Excel;

class ExcelExpoter extends AbstractExporter
{
    public function export()
    {
        Excel::create('Filename', function($excel) {

            $excel-&gt;sheet('Sheetname', function($sheet) {

                // 这段逻辑是从表格数据中取出需要导出的字段
                $rows = collect($this-&gt;getData())-&gt;map(function ($item) {
                    return array_only($item, ['id', 'title', 'content', 'rate', 'keywords']);
                });

                $sheet-&gt;rows($rows);

            });

        })-&gt;export('xls');
    }
}
</code></pre>
<p>然后在model-grid中使用这个导出类</p>
<pre><code class="language-php">use App\Admin\Extensions\ExcelExpoter;

$grid-&gt;exporter(new ExcelExpoter());
</code></pre>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接: </strong>
      <a href="http://blog.zhishibee.com/1/01/laravel-admin-%E5%9F%BA%E7%A1%80%E8%A1%A8%E6%A0%BC/" title="" target="_blank" rel="external">http://blog.zhishibee.com/1/01/laravel-admin-%E5%9F%BA%E7%A1%80%E8%A1%A8%E6%A0%BC/</a>
    </li>
    <li class="post-copyright-license">
      <strong>License：</strong><a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/my101du" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://avatars2.githubusercontent.com/u/1332645?s=460&amp;u=dc114d6baad010456a5af87c4cc2df0694ff2b1c&amp;v=4" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/my101du" target="_blank"><span class="text-dark">my101du</span><small class="ml-1x"></small></a></h3>
        <div>Stay Hungry, Stay Foolish</div>
      </div>
    </figure>
  </div>
</div>
    </div>
  </article>
<section id="comments">
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="http://blog.zhishibee.com/1/01/laravel-admin-%E6%9B%B4%E5%A4%9A/" title=""><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;下一篇</span></a>
            </li>
            <li class="next">
                <a href="http://blog.zhishibee.com/1/01/adminlte/"
                    title=""><span>上一篇&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="文章目录" role="button">
                    <span>[&nbsp;</span><span>文章目录</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter"
                data-mobile-sites="weibo,qq,qzone"></div>
        </div>
    </div>
</nav>

</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/my101du" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="http://blog.zhishibee.com/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2017  -
    2020
    <div class="publishby">
        Theme by <a href="https://github.com/xiaoheiAh" target="_blank"> xiaoheiAh </a>base on<a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank"> pure</a>.
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/php.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="http://blog.zhishibee.com/js/application.min.bdeb64b910570b6c41badc6a05b7afb0c8ad9efd8525de3c7257d59e786326a3.js"></script>
<script src="http://blog.zhishibee.com/js/plugin.min.51ff8c7317566f82259170fa36e09c4493adc9b9378b427a01ad3f017ebac7dd.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(未命名)',
            },
            ROOT_URL: 'http:\/\/blog.zhishibee.com\/',
            CONTENT_URL: 'http:\/\/blog.zhishibee.com\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="http://blog.zhishibee.com/js/insight.min.a343cd9a5a7698336b28ef3a7c16a3a1b1d2d5fb17dc8ed04022bbe08cc5459073a15bdafa3a8a58cdd56080784bdd69fa70b1ae8597565c799c57ed00f0e120.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


  </body>
</html>
