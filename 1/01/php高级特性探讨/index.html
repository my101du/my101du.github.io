<!DOCTYPE html>
<html lang="zh">
  <head>
    <title>
         - my101du Blog
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="title: PHP高级特性探讨 permalink: php-advanced-feature tags:
 php  " />
    <meta name="generator" content="Hugo 0.70.0 with theme pure" />
    <title> - my101du Blog</title>
    
    
    <link rel="stylesheet" href="https://my101du.github.io/css/style.min.7dc20efbc53647d41aa9ddea0c48e59300223d084e66ea0cbe7c30bd88903acc.css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css" async>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="" />
<meta property="og:description" content="title: PHP高级特性探讨
permalink: php-advanced-feature
tags:

php

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://my101du.github.io/1/01/php%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E6%8E%A2%E8%AE%A8/" />

<meta itemprop="name" content="">
<meta itemprop="description" content="title: PHP高级特性探讨
permalink: php-advanced-feature
tags:

php

">

<meta itemprop="wordCount" content="5561">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="title: PHP高级特性探讨
permalink: php-advanced-feature
tags:

php

"/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->
  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://github.com/my101du" target="_blank">
            <img class="img-circle img-rotate" src="https://avatars2.githubusercontent.com/u/1332645?s=460&amp;u=dc114d6baad010456a5af87c4cc2df0694ff2b1c&amp;v=4" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">my101du</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Dongguan, China</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="想要查找什么..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content"><p>enjoy~</p>
            </div>
        </div>
    </div>
</div>

      <div class="widget">
    <h3 class="widget-title"> 分类</h3>
    <div class="widget-body">
        <ul class="category-list">
        </ul>
    </div>
</div>
      <div class="widget">
    <h3 class="widget-title"> 标签</h3>
    <div class="widget-body">
        <ul class="tag-list">
            
        </ul>

    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://my101du.github.io/1/01/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://my101du.github.io/1/01/bootstrap-%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%E4%B8%8E%E6%8A%80%E5%B7%A7/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://my101du.github.io/1/01/bootstrap4/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://my101du.github.io/1/01/css-%E5%8A%A8%E7%94%BB/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://my101du.github.io/1/01/css-%E5%8A%A8%E7%94%BB%E5%BA%93-animate.css/" class="title"></a>
                    </p>
                    <p class="item-date">
                        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">0001-01-01</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">文章目录</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/1/01/php%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E6%8E%A2%E8%AE%A8/"
    ></a
  >
</h1>

      <div class="article-meta">
        

        <span class="post-comment"><i class="icon icon-comment"></i>&nbsp;<a href="/1/01/php%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E6%8E%A2%E8%AE%A8/#comments"
            class="article-comment-link">评论</a></span>
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 5561字</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 12分 </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <p>title: PHP高级特性探讨
permalink: php-advanced-feature
tags:</p>
<ul>
<li>php</li>
</ul>
<hr>
<p>array_walk 为什么没有处理所有的 item</p>
<p><a href="https://stackoverflow.com/questions/26377761/deleting-rows-in-callback-function-in-array-walk">https://stackoverflow.com/questions/26377761/deleting-rows-in-callback-function-in-array-walk</a></p>
<h1 id="面向对象">面向对象</h1>
<h2 id="抽象类--抽象方法">抽象类 、 抽象方法</h2>
<pre><code class="language-php">abstract class A {
    /** 抽象类中可以定义变量 */  
    protected $value1 = 0;  
    private $value2 = 1;  
    public $value3 = 2;  
   
    /** 
     * 大多数情况下，抽象类至少含有一个抽象方法。抽象方法用abstract关键字声明，其中不能有具体内容。 
     * 可以像声明普通类方法那样声明抽象方法，但是要以分号而不是方法体结束。也就是说抽象方法在抽象类中不能被实现，也就是没有函数体“{some codes}”。 
     */  
    abstract protected function abstract_func1();  
    abstract protected function abstract_func2();  
    
    /** 也可以定义非抽象方法 */  
    public function my_print()  
    {  
        echo &quot;hello,world/n&quot;;  
    }  
}
</code></pre>
<ul>
<li>抽象类不能被直接实例化，只能被子类继承</li>
<li>抽象类中只定义（或部分实现）子类需要的方法。子类可以通过继承抽象类并通过实现抽象类中的所有抽象方法，使抽象类具体化</li>
<li>如果子类需要实例化，前提是它实现了抽象类中的所有抽象方法（如果子类没有全部实现抽象类中的所有抽象方法，那么该子类也是一个抽象类，必须在 class 前面加上 abstract 关键字，并且不能被实例化。）</li>
<li>如果 B 实现了抽象方法 abstract_func() ，那么 B 中 abstract_func() 方法的访问控制不能比 A 中 abstract_func() 的访问控制更严格
<ul>
<li>A 中 abstract_func() 声明为 public ，那么 B 中 abstract_func() 的声明只能是 public</li>
<li>A 中 abstract_func() 声明为 protected ，那么 B 中 abstract_func() 的声明可以是 public 或 protected ，但不能是 private</li>
<li>A 中 abstract_func() <strong>不能</strong>声明为 private</li>
</ul>
</li>
</ul>
<pre><code class="language-php">// 因为 class B  还没有实现抽象类 A 的`abstract_func2`方法，所以它也必须被定义成抽象类
abstract class B extends A  
{  
    // 实现抽象类 A 的抽象方法 abstract_func1
    public function abstract_func1()  
    {  
       echo &quot;implement the abstract_func1 in class A/n&quot;;  
    }  
    /** 这么写在zend studio 8中会报错*/  
    //abstract protected function abstract_func2();  
}  

// class C 继承抽象类 B, 并实现抽象类 B 里来自抽象类 A 且尚未实现的抽象方法 abstract_func2
class C extends B  
{  
    public function abstract_func2()  
    {  
       echo &quot;implement the abstract_func2 in class A/n&quot;;  
    }  
}  

// 现在可以实例化 class C 了
$c = new C()
</code></pre>
<h2 id="接口">接口</h2>
<p>与抽象类的区别： <code>抽象类</code><strong>提供了具体实现的标准</strong>，而<code>接口</code>则是纯粹的<strong>模版</strong>（接口只定义功能，而不包含实现的内容）</p>
<ul>
<li><code>interface</code> 是完全抽象的，只能声明 <code>public</code> 的方法，不能声明 private 及 protected 的方法，不能定义方法体，也不能声明<strong>实例变量</strong> （只能声明<strong>常量变量</strong>，但将常量变量放在 interface 中违背了其作为接口的作用而存在的宗旨，也混淆了 interface 与类的不同价值。如果的确需要，可以将其放在相应的 abstract class 或 Class 中）</li>
<li>任何<strong>实现接口的类</strong>都要<strong>实现接口中</strong>所定义的<strong>所有方法</strong></li>
<li>一个类可以同时继承一个父类和实现任意多个接口</li>
<li>接口不可以实现另一个接口，但可以继承多个</li>
</ul>
<pre><code class="language-php">interface iA  
{  
    const AVAR=3;  
    public function iAfunc1();  
    public function iAfunc2();  
}  
echo iA:: AVAR;  


// 实现接口的类，必须实现接口中定义的所有方法。实现接口的具体过程和继承一个仅包含抽象方法的抽象类是一样的
class E implements iA  
{  
    public function iAfunc1(){echo &quot;in iAfunc1&quot;;}  
    public function iAfunc2(){echo &quot;in iAfunc2&quot;;}  
}  

// 否则，它只能声明为抽象类
abstract class E implements iA{} 

// 继承一个类，实现多个接口
interface iB  
{  
    public function iBfunc1();  
    public function iBfunc2();  
}  
class D extends B implements iA,iB  
{  
    public function abstract_func1()  
    {  
        //调用父类的方法
       parent::abstract_func1(); 
        
       echo &quot;override the abstract_func1 in class A/n&quot;;  
    }  
    public function abstract_func2()  
    {  
       echo &quot;implement the abstract_func2 in class A/n&quot;;  
    }  
    public function iAfunc1(){echo &quot;in iAfunc1&quot;;}  
    public function iAfunc2(){echo &quot;in iAfunc2&quot;;}  
    public function iBfunc1(){echo &quot;in iBfunc1&quot;;}  
    public function iBfunc2(){echo &quot;in iBfunc2&quot;;}  
}  


// 接口不可以实现另一个接口，但可以继承多个
interface iC extends iA,iB{}  
class F implements iC  
{  
    public function iAfunc1(){echo &quot;in iAfunc1&quot;;}  
    public function iAfunc2(){echo &quot;in iAfunc2&quot;;}  
    public function iBfunc1(){echo &quot;in iBfunc1&quot;;}  
    public function iBfunc2(){echo &quot;in iBfunc2&quot;;}  
}  

</code></pre>
<h2 id="接口和抽象类的异同">接口和抽象类的异同</h2>
<p>相同点：</p>
<ol>
<li>两者都是抽象类，都不能实例化。</li>
<li>interface 实现类及 abstract class 的子类都必须要实现已经声明的抽象方法。</li>
</ol>
<p>不同点：</p>
<ol>
<li>interface 需要实现，要用 implements ，而 abstract class 需要继承，要用 extends 。</li>
<li>一个类可以实现多个 interface ，但一个类只能继承一个 abstract class 。</li>
<li>interface 强调特定功能的实现，而 abstract class 强调所属关系。</li>
<li>尽管 interface 实现类及 abstract class 的子类都必须要实现相应的抽象方法，但实现的形式不同。 interface 中的每一个方法都是抽象方法，都只是声明的 (declaration, 没有方法体 ) ，实现类必须要实现。而 abstract class 的子类可以有选择地实现。这个选择有两点含义： a) abstract class 中并非所有的方法都是抽象的，只有那些冠有 abstract 的方法才是抽象的，子类必须实现。那些没有 abstract 的方法，在 abstract class 中必须定义方法体； b) abstract class 的子类在继承它时，对非抽象方法既可以直接继承，也可以覆盖；而对抽象方法，可以选择实现，也可以留给其子类来实现，但此类必须也声明为抽象类。既是抽象类，当然也不能实例化。</li>
<li>abstract class 是 interface 与 class 的中介。 abstract class 在 interface 及 class 中起到了承上启下的作用。一方面， abstract class 是抽象的，可以声明抽象方法，以规范子类必须实现的功能；另一方面，它又可以定义缺省的方法体，供子类直接使用或覆盖。另外，它还可以定义自己的实例变量，以供子类通过继承来使用。</li>
<li>接口中的抽象方法前不用也不能加 abstract 关键字，默认隐式就是抽象方法，也不能加 final 关键字来防止抽象方法的继承。而抽象类中抽象方法前则必须加上 abstract 表示显示声明为抽象方法。</li>
<li>接口中的抽象方法默认是 public 的，也只能是 public 的，不能用 private ， protected 修饰符修饰。而抽象类中的抽象方法则可以用 public ， protected 来修饰，但不能用 private 。</li>
</ol>
<p>interface 的应用场合</p>
<p>(1)      类与类之间需要特定的接口进行协调，而不在乎其如何实现。
(2)      作为能够实现特定功能的标识存在，也可以是什么接口方法都没有的纯粹标识。
(3)      需要将一组类视为单一的类，而调用者只通过接口来与这组类发生联系。
(4)      需要实现特定的多项功能，而这些功能之间可能完全没有任何联系。</p>
<p>abstract class 的应用场合</p>
<p>一句话，在既需要统一的接口，又需要实例变量或缺省的方法的情况下，就可以使用它。最常见的有：</p>
<p>(1)      定义了一组接口，但又不想强迫每个实现类都必须实现所有的接口。可以用 abstract class 定义一组方法体，甚至可以是空方法体，然后由子类选择自己所感兴趣的方法来覆盖。
(2)      某些场合下，只靠纯粹的接口不能满足类与类之间的协调，还必需类中表示状态的变量来区别不同的关系。 abstract 的中介作用可以很好地满足这一点。
(3)      规范了一组相互协调的方法，其中一些方法是共同的，与状态无关的，可以共享的，无需子类分别实现；而另一些方法却需要各个子类根据自己特定的状态来实现特 定的功能 。</p>
<h2 id="static-静态关键字">static 静态关键字</h2>
<p>静态属性、方法（包括静态与非静态）在内存中，只有一个位置（而非静态属性，有多少实例化对象，就有多少个属性</p>
<p>定义静态方法和属性，也可以 定义静态变量 以及 后期静态绑定</p>
<p><a href="http://bbs.csdn.net/topics/320025867">http://bbs.csdn.net/topics/320025867</a></p>
<p>声明类属性或方法为静态，就可以<strong>不实例化类而直接访问</strong></p>
<pre><code class="language-php">class Foo {
    public static $my_static = 'foo';
    
    public function getStaticValue() {
        return self::$my_static;
    }
    
    public static function staticMethod() {
    
    }
}

class Bar extends Foo
{
    public function fooStatic() {
        return parent::$my_static;
    }
}

// 不需要实例化，直接访问
$a = Foo::$my_static;
Foo::staticMethod();

Bar::$my_static;
$bar = new Bar();
print $bar-&gt;fooStatic();
</code></pre>
<ul>
<li>伪变量 <code>$this</code> 在静态方法中不可用, 必须用 <code>self::</code>（静态方法调用静态属性，使用self关键词，因为 $this代表实例化对象，而这里是类，不知道 $this 代表哪个对象）</li>
<li>静态属性不可以由对象通过 -&gt; 操作符来访问</li>
<li>其中静态属性不能通过一个类已实例化的对象来访问，必须是一个未实例化的类（但静态方法可以）</li>
<li>用静态方式调用一个非静态方法会导致一个 E_STRICT 级别的错误</li>
<li>静态方法不能调用非静态属性  因为非静态属性需要实例化后，存放在对象里</li>
<li>PHP 5.3.0 起，可以用一个变量来动态调用类。但该变量的值不能为关键字 self，parent 或 static</li>
<li>调用静态方法时，不会执行构造方法，只有实例化对象时才会触发构造函数，输出下面的内容</li>
</ul>
<pre><code class="language-php">class TestClass {
    public static $my_static = 'foo';
    
    public function __construct(){
       $this-&gt;age = &quot;Corwien&quot;;
       // 测试调用静态方法时，不会执行构造方法，只有实例化对象时才会触发构造函数，输出下面的内容。
      echo __LINE__,__FILE__,'&lt;br&gt;'; 
    
    }
    
    public function getStaticValue() {
        
        // 错误  伪变量 `$this` 在静态方法中不可用
        // echo $this-&gt;my_static;
        
        return self::$my_static;
    }
    
    public static function staticMethod() {
    
    }
    
    public function 
}

// 实例化的对象
$foo = new Foo();

// 错误， 静态属性不能通过一个 类已实例化的对象 来访问  Undefined &quot;Property&quot; my_static 
echo $foo-&gt;my_static;

$foo::$my_static;

// 静态方法可以
print $foo-&gt;staticValue()

// 5.3 开始，可以用变量来动态调用类，相当于 Foo::$my_static
$classname = 'Foo';
print $classname::$my_static . &quot;\n&quot;; // As of PHP 5.3.0
</code></pre>
<h2 id="重载父类的构造方法">重载父类的构造方法</h2>
<p>默认子类在实例化的时候，会自动调用父类的构造方法</p>
<pre><code class="language-php">class a extends b { 
} 

class b { 
   public function __construct() 
   { 
      echo 'In B Constructor'; 
   } 
} 

$x = new a();

</code></pre>
<p>如果子类自己定义构造方法，则会<strong>替代</strong>父类的构造方法</p>
<pre><code class="language-php">class a extends b { 
   public function __construct() 
   { 
      echo 'In A Constructor'; 
   } 
} 

class b { 
   public function __construct() 
   { 
      echo 'In B Constructor'; 
   } 
} 

$x = new a();
</code></pre>
<p>那么既想<strong>保留父类构造</strong>方法里，又想在子类的构造方法中进行一些<strong>新的处理</strong>怎么办呢？
使用<code>parent::__construct()</code></p>
<pre><code class="language-php">class a extends b { 
   public function __construct() 
   { 
      parent::__construct();
      echo 'In A Constructor'; 
   } 
} 

class b { 
   public function __construct() 
   { 
      echo 'In B Constructor'; 
   } 
} 

$x = new a();
</code></pre>
<h2 id="重载一个已经存在的函数">重载一个已经存在的函数</h2>
<p>php 默认是无法重载已经加载进来的文件中的函数的。</p>
<p>如果我们引入了外部的库，又重新定义了某个同名函数，就会报错</p>
<p><img src="/media/15490410132712/15471103936037.jpg" alt="-w1211"></p>
<p>用魔术方法 __call 可实现，但这需要是类方法。  如果是单独的一个函数定义则不行。</p>
<h3 id="runkit-扩展-实现重新对函数进行定义">runkit 扩展 实现重新对函数进行定义</h3>
<p><a href="http://php.net/manual/en/book.runkit.php">http://php.net/manual/en/book.runkit.php</a></p>
<p><code>runkit_function_redefine</code></p>
<h1 id="composer-包管理与-autoload">Composer 包管理与 autoload</h1>
<pre><code class="language-shell">composer require author/library
</code></pre>
<p>生成 <code>vendor</code> 文件夹，view the <code>autoload.php</code> file, you can go to <code>vendor/composer/autoload_real.php</code>  to see the &ldquo;real&rdquo; call</p>
<h2 id="深入-composer-autoload">深入 Composer autoload</h2>
<p>名词：</p>
<p><code>psr</code> 是一种规范， 例如 psr-0 psr-4
<code>pear</code> 是比较古老的一个包管理系统，例如 PHP_Unit 等可以通过它来安装 不怎么遵循 psr 规范，自成一套
<code>composer</code> 是新的包管理器。类似 npm, 不过更专注于“基于项目”, 而不是“全局”。</p>
<h3 id="核心的-vendorcomposerautoload_realphp动态加载文件以及-spl_autoload_register">核心的 <code>vendor/composer/autoload_real.php</code>动态加载文件以及 <code>spl_autoload_register</code></h3>
<p>查看文件代码，首先是一个 <strong>全局类</strong>（为了不让这个 autoload 的 helper 污染全局，只好把名称弄成这么复杂的hash）</p>
<pre><code class="language-php">class ComposerAutoloaderInitee70723fd3132b6d05f0ff016c58b71b{
</code></pre>
<h4 id="getloader方法"><code>getLoader()</code>方法</h4>
<ol>
<li>
<p>找 Composer\ClassLoader ，如果不存在就是生成一个实例放在 ComposerAutoloaderInit64c47026c93126586e44d036738c0862 中</p>
</li>
<li>
<p>然后将 composer cli 生成的各种 autoload_psr4, autoload_classmap, autoload_namespaces(psr-0) 全都注册到 Composer\ClassLoader 中。</p>
</li>
<li>
<p>直接 require 所有在 autoload_files 中的文件</p>
</li>
</ol>
<p>例如<code>autoload_psr4</code>部分，注册到 <code>ClassLoader</code>（参考自 aliyun sms）</p>
<pre><code class="language-php">$map = require __DIR__ . '/autoload_psr4.php';
foreach ($map as $namespace =&gt; $path) {
    $loader-&gt;setPsr4($namespace, $path);
}
</code></pre>
<h4 id="composer-提供了几种自动加载的类型">composer 提供了几种自动加载的类型</h4>
<ul>
<li>classmap  （psr-0 已经被抛弃了，不过有些历史遗留依然在用，所以偶尔也会看到。）</li>
<li>psr-0  （development 相关用 classmap 自动加载）</li>
<li>psr-4  （项目代码用 psr-4 自动加载）</li>
<li>files  （helper 用 files 自动加载）</li>
</ul>
<p>分别对应了目录下的同名文件，例如<code>autoload_psr4.php</code> 。</p>
<p>例如自己有一个项目目录 <code>/lib</code>, 要加载进来的话，<code>autoload_psr4.php</code>代码如下，指定 namespace</p>
<pre><code class="language-php">$vendorDir = dirname(dirname(__FILE__));
$baseDir = dirname($vendorDir);

return array(
    // phpDocumentor\\Reflection\\ 等等
    
    // 自己的项目目录
    'Aliyun\\Test\\' =&gt; array($baseDir . '/tests'),
    'Aliyun\\' =&gt; array($baseDir . '/lib'),
);
</code></pre>
<p>在 laravel 里是这样的，只要简单指定目录就可以了</p>
<pre><code class="language-php">{
  &quot;classmap&quot;: [&quot;src/&quot;]
}
</code></pre>
<p>composer 在背后就会读取这个文件夹中所有的文件 然后再 vendor/composer/autoload_classmap.php 中将所有的 class 的 namespace + classname 生成成一个 key =&gt; value 的 php 数组</p>
<p><strong>然后调用<code>spl_autoload_register</code>来自动加载</strong>
其实是生成一个 <code>classmap</code></p>
<h4 id="最后有个函数composerrequire64c47026c93126586e44d036738c0862">最后有个函数<code>composerRequire64c47026c93126586e44d036738c0862</code></h4>
<p>这是因为如果有人在 autoload_files 中的文件中写 <code>$this</code> 或者 <code>self</code>。所以当require 一个file的时候我们希望解释器能够成功报错。</p>
<h4 id="关于composer-dump-autoload">关于<code>composer dump-autoload</code></h4>
<p>因为 database 文件夹使用 classmap 来做加载的。所以只有在打了 composer dumpautoload 之后 composer 才会更新 autoload_classmap 的内容。</p>
<p>怎样可以避免一直打 <code>composer dump-autoload</code>？</p>
<p><code>psr-4</code> 注册一个文件夹这样增减文件就不用再管了。Composer\ClassLoader 会自动检查 composer.json 中注册的 psr-4 入口然后根据 psr-4 去自动查找文件。</p>
<p>查看<code>Composer\ClassLoader</code>的 <code>findFileWithExtension($class, $ext)</code>方法，里面有详细的 psr-0 和 psr-4 是怎么判断文件存在和引入文件的。</p>
<p>因此这个自动加载的过程很复杂（O(n2) ），还有很多 is_file 之类 I/O 操作，对性能影响较大。</p>
<p>为了&quot;空间换时间&rdquo;</p>
<p>Compsoer\ClassLoader 会<strong>优先查看 autoload_classmap 中所有生成的注册类</strong>。如果在classmap 中没有发现再 fallback 到 psr-4 然后 psr-0</p>
<p>所以当打了 composer dump-autoload -o 之后，composer 就会提前加载需要的类并提前返回。这样大大减少了 IO 和深层次的 loop。</p>
<h3 id="过时的-psr-0-与-最新的-psr-4">过时的 psr-0 与 最新的 psr-4</h3>
<h4 id="psr-0">psr-0</h4>
<p>autoload 配置中 <code>psr-0</code> 如下</p>
<pre><code class="language-php">{
  &quot;name&quot;: &quot;acme/util&quot;,
  &quot;auto&quot; : {
    &quot;psr-0&quot;: {
      &quot;Acme\\Util\\&quot;: &quot;src/&quot;
    }
  }
}
</code></pre>
<p>文档结构如下, 由于旧版本的 php 没有 <code>namespace</code> 所以必须通过 <code>_</code> 将类区分开. 太麻烦了，指向一个文件夹之后， 还要在 src 中分成好几层文档树</p>
<pre><code class="language-json">vendor/
  acme/
    util/
      composer.json
      src/
        Acme/
          Util/
            ClassName.php
</code></pre>
<p>其中<code>ClassName.php</code>中是这样的.</p>
<pre><code class="language-php">class Acme_Util_ClassName{}
</code></pre>
<p><code>psr-0</code> 的标准主要考虑到了 &lt;5.2 的 php 中 类似 Acme_Util_ClassName 这样的写法（psr-0 要求 autoloading 的时候<strong>将 类中的 _ 转义为 &lsquo;'</strong>）</p>
<h4 id="psr-4">psr-4</h4>
<p>php5.2 版本已经彻底被抛弃的今天， FIG 推出了 psr-4.</p>
<p>可以把 prs-4 的 namespace 直接想想成 file structure</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;acme/util&quot;,
  &quot;auto&quot; : {
    &quot;psr-4&quot;: {
      &quot;Acme\\Util\\&quot;: &quot;src/&quot;
    }
  }
}
</code></pre>
<p>对应文档结构. 将 <code>Acme\Util</code> 指向了 <code>src</code> 之后 psr-4 就会默认所有的 src 下面的 class 都已经有了 Acme\Util 的 基本 namespace，而 psr-4 中不会将 _ 转义成 \ 所以就没有必要有 psr-0 那么深得文档结构了</p>
<pre><code class="language-json">vendor/
  acme/
    util/
      composer.json
      src/
        ClassName.php
</code></pre>
<p>因此 ClassName.php 里也不需要用 _ 来命名类名了, 只要指定 <code>namespace</code>（Acme\Util） 就可以（已经属于 Acme\Util 的 基本 namespace）</p>
<pre><code class="language-php">namespace Acme\Util;
class ClassName {}
</code></pre>
<h3 id="file-全局的-helper-function-">file （全局的 helper function ）</h3>
<pre><code class="language-json">{
  &quot;files&quot;: [
    &quot;path/to/file.php&quot;
  ]
}
</code></pre>
<h2 id="案例-实现-psr-0-与-psr-4-的文件结构类文件">案例， 实现 psr-0 与 psr-4 的文件结构，类文件</h2>
<p><a href="https://my.oschina.net/sallency/blog/893518">https://my.oschina.net/sallency/blog/893518</a></p>
<h1 id="gd">GD</h1>
<p>测试 GD 的函数（例如有时候验证码图片需要它生成）</p>
<pre><code class="language-php">$testGD = get_extension_funcs(&quot;gd&quot;); // Grab function list 
if (!$testGD){ echo &quot;GD not even installed.&quot;; exit; }
echo &quot;&lt;pre&gt;&quot;.print_r($testGD,true).&quot;&lt;/pre&gt;&quot;;
</code></pre>
<h1 id="直接使用-php-内置的-web-server-快速调试程序不需要-nginx">直接使用 php 内置的 web server 快速调试程序，不需要 nginx</h1>
<p>有时候为了快速运行一些 php 脚本(例如测试 php docker 镜像的功能)，并不想安装 Nginx 等 web 服务，可以直接使用 PHP 提供的内置 web 服务，方法如下</p>
<pre><code class="language-shell">php -S localhost:8000 -t /var/www/html
</code></pre>
<p>如果是 docker 容器，要先暴露一个端口，然后运行的主机是 0.0.0.0</p>
<pre><code class="language-shell">docker run --name test-php -p 9000:9000 -p 8000:8000 -v /phpfiles:/var/www/html -dit php:7.1-fpm-alpine

docker exec -i test-php php -S 0.0.0.0:8000 -t /var/www/html/
</code></pre>
<h1 id="curl-转-php-的代码">curl 转 php 的代码</h1>
<p><a href="https://incarnate.github.io/curl-to-php/">https://incarnate.github.io/curl-to-php/</a></p>
<h1 id="命令行">命令行</h1>
<p>php -m  查看模块</p>
<p>php -v  版本</p>
<p>php -r &ldquo;echo &lsquo;aa&rsquo;;&rdquo;  运行脚本</p>
<h1 id="优化">优化</h1>
<h2 id="执行长时间任务">执行长时间任务</h2>
<p><a href="https://www.oschina.net/question/658786_2253461">https://www.oschina.net/question/658786_2253461</a></p>
<p>不想粗暴地修改 php 和 nginx 配置，这会带来一些问题（例如其他一些有问题的脚本也会一直执行下去）</p>
<p>可选方案</p>
<p>（1）长时间任务用cli运行   （https://laravel-china.org/topics/3842/can-laravel-run-in-cli-mode larvel  <a href="https://laravel-china.org/docs/laravel/5.5/artisan">https://laravel-china.org/docs/laravel/5.5/artisan</a> cli）  这样只走 php 的时间控制参数，不受 nginx 的限制？
（2）pthreads
（3）http://git.oschina.net/cqcqphper/taskPHP  定时计划任务框架，cli模式运行，多进程，多线程
（4）Laravel中的Job Queues ？</p>
<h1 id="内存泄露分析">内存泄露分析</h1>
<p><a href="https://juejin.im/entry/59e034ce6fb9a0450406e267">https://juejin.im/entry/59e034ce6fb9a0450406e267</a></p>
<h1 id="性能对比">性能对比</h1>
<p><a href="https://juejin.im/entry/59dade8af265da0664646a66">https://juejin.im/entry/59dade8af265da0664646a66</a></p>
<p><a href="https://www.v2ex.com/t/343299">https://www.v2ex.com/t/343299</a></p>
<h1 id="php-fpm-慢日志">php-fpm 慢日志</h1>
<p>修改 php-fpm.conf 相关配置文件，打开下面两个</p>
<pre><code class="language-shell"># 运行缓慢脚本日志保存位置
slowlog = /var/log/php/php-fpm-slowlog.log

# 超过多长时间就算执行缓慢
request_slowlog_timeout = 3s
</code></pre>
<p>然后重启 php-fpm 服务，确保新的配置生效</p>
<p>测试脚本</p>
<pre><code class="language-php">sleep(5);
echo 'done';
</code></pre>
<p>在 Docker 容器里运行的 php，不会写入任何内容，这是因为</p>
<p><a href="https://serverfault.com/questions/704007/php-slowlog-causing-ptrace-error-in-docker-container/706982#706982">https://serverfault.com/questions/704007/php-slowlog-causing-ptrace-error-in-docker-container/706982#706982</a>
<a href="https://docs.docker.com/compose/compose-file/#cap_add-cap_drop">https://docs.docker.com/compose/compose-file/#cap_add-cap_drop</a></p>
<pre><code class="language-shell"># 列出所有
man 7 capabilities
</code></pre>
<p>需要修改 docker file 或 docker-compose.yaml</p>
<pre><code class="language-yaml">cap_add:
  - SYS_PTRACE
</code></pre>
<p>运行脚本，记录了运行慢的位置。</p>
<p><img src="/media/15490410132712/15360239643842.jpg" alt="-w559"></p>
<h1 id="sftp">SFTP</h1>
<p><a href="https://stackoverflow.com/questions/37033723/use-php-curl-to-connect-to-sftp-with-private-key">https://stackoverflow.com/questions/37033723/use-php-curl-to-connect-to-sftp-with-private-key</a></p>
<p><a href="http://php.net/manual/en/ssh2.installation.php">http://php.net/manual/en/ssh2.installation.php</a></p>
<h2 id="安装-ssh2-的-pecl-扩展然后使用ssh2_scp_send">安装 SSH2 的 Pecl 扩展，然后使用<code>ssh2_scp_send</code></h2>
<p><a href="http://www.php.net/manual/en/function.ssh2-scp-send.php">http://www.php.net/manual/en/function.ssh2-scp-send.php</a></p>
<pre><code class="language-php"># check the extension has been installed.
echo function_exists('ssh2_scp_send');
exit();
</code></pre>
<h2 id="phpseclib">phpseclib</h2>
<p><a href="https://www.glenscott.co.uk/uploading-file-sftp-server-php-curl/">https://www.glenscott.co.uk/uploading-file-sftp-server-php-curl/</a></p>
<p>下载 <a href="http://phpseclib.sourceforge.net/">http://phpseclib.sourceforge.net/</a></p>
<p><img src="/media/15490410132712/15366357656915.jpg" alt="-w262"></p>
<p>Example:
<a href="http://phpseclib.sourceforge.net/new/sftp/examples.html">http://phpseclib.sourceforge.net/new/sftp/examples.html</a> (Login method is &ldquo;RSA Key&rdquo;)</p>
<pre><code class="language-php">include('Net/SFTP.php');
include('Crypt/RSA.php');

$sftp = new Net_SFTP('www.domain.tld');
$key = new Crypt_RSA();
$key-&gt;loadKey(file_get_contents('privatekey'));
if (!$sftp-&gt;login('username', $key)) {
    exit('Login Failed');
}

// puts a three-byte file named filename.remote on the SFTP server
$sftp-&gt;put('filename.remote', 'xxx');
</code></pre>
<h2 id="封装了-phpseclib-的-laravel-包">封装了 phpseclib 的 laravel 包</h2>
<p><a href="https://github.com/neoxia/laravel-sftp/tree/master/src/Neoxia/Filesystem">https://github.com/neoxia/laravel-sftp/tree/master/src/Neoxia/Filesystem</a>
<a href="https://packagist.org/packages/league/flysystem-sftp">https://packagist.org/packages/league/flysystem-sftp</a>
<a href="http://flysystem.thephpleague.com/docs/adapter/sftp/">http://flysystem.thephpleague.com/docs/adapter/sftp/</a>
<a href="https://flysystem.thephpleague.com/docs/">https://flysystem.thephpleague.com/docs/</a></p>
<p>或 5.6 版自带了。</p>
<h1 id="技能">技能</h1>
<h2 id="如何得到一个-php-项目的结构-以及代码阅读工具">如何得到一个 php 项目的结构 以及代码阅读工具</h2>
<p><strong>Source Insight</strong>
<a href="http://www.voidcn.com/article/p-nhvsgsxy-ut.html">http://www.voidcn.com/article/p-nhvsgsxy-ut.html</a></p>
<p><strong>understand</strong>
<a href="https://scitools.com">https://scitools.com</a>
官网找不到购买信息</p>
<p><a href="https://xclient.info/s/understand.html">https://xclient.info/s/understand.html</a></p>
<p><strong>PHPXref</strong>
它能够使你快速读懂代码。这是因为，经过它处理后生成的文档中，你鼠标指针所到之处，它就会显示，这个函数在哪定义，哪些地方用到，包括是不是PHP函数，它都告诉你。对于变量，类也一样，并且，文件清单中，同时把文件中的注解也提取出来，让你一看就知此文件是做什么用的。</p>
<p>当然，它也不是万能的，仍有一项不足，那就是，对于完全面向对象的程序，对象的流程，它是不能表示出来的。比不上ROSE的反向工程功能。</p>
<p><a href="https://www.zhihu.com/question/20126782">https://www.zhihu.com/question/20126782</a></p>
<p>UML
<a href="http://www.laruence.com/2010/05/14/1473.html">http://www.laruence.com/2010/05/14/1473.html</a></p>
    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接: </strong>
      <a href="https://my101du.github.io/1/01/php%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E6%8E%A2%E8%AE%A8/" title="" target="_blank" rel="external">https://my101du.github.io/1/01/php%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E6%8E%A2%E8%AE%A8/</a>
    </li>
    <li class="post-copyright-license">
      <strong>License：</strong><a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/my101du" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://avatars2.githubusercontent.com/u/1332645?s=460&amp;u=dc114d6baad010456a5af87c4cc2df0694ff2b1c&amp;v=4" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/my101du" target="_blank"><span class="text-dark">my101du</span><small class="ml-1x"></small></a></h3>
        <div>Stay Hungry, Stay Foolish</div>
      </div>
    </figure>
  </div>
</div>
    </div>
  </article>
<section id="comments">
</section>

</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://my101du.github.io/1/01/psr-7/" title=""><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;下一篇</span></a>
            </li>
            <li class="next">
                <a href="https://my101du.github.io/1/01/php%E8%BD%BB%E8%AE%BA%E5%9D%9B/"
                    title=""><span>上一篇&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="文章目录" role="button">
                    <span>[&nbsp;</span><span>文章目录</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter"
                data-mobile-sites="weibo,qq,qzone"></div>
        </div>
    </div>
</nav>

</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/my101du" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://my101du.github.io/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2017  -
    2020
    <div class="publishby">
        Theme by <a href="https://github.com/xiaoheiAh" target="_blank"> xiaoheiAh </a>base on<a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank"> pure</a>.
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/php.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://my101du.github.io/js/application.min.bdeb64b910570b6c41badc6a05b7afb0c8ad9efd8525de3c7257d59e786326a3.js"></script>
<script src="https://my101du.github.io/js/plugin.min.51ff8c7317566f82259170fa36e09c4493adc9b9378b427a01ad3f017ebac7dd.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(未命名)',
            },
            ROOT_URL: 'https:\/\/my101du.github.io\/',
            CONTENT_URL: 'https:\/\/my101du.github.io\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://my101du.github.io/js/insight.min.a343cd9a5a7698336b28ef3a7c16a3a1b1d2d5fb17dc8ed04022bbe08cc5459073a15bdafa3a8a58cdd56080784bdd69fa70b1ae8597565c799c57ed00f0e120.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


  </body>
</html>
